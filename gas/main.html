<script>
'use strict'
{
  class Panel {
    constructor(counter) {
      this.counter = counter
      this.el = document.createElement('li')
      this.el.classList.add('pressed')
      this.el.textContent = 'Reset'
      this.el.addEventListener('click', () => {
        this.check()
      })
    }

    getEl() {
      return this.el
    }

    activate(num) {
      this.el.classList.remove('pressed')
      this.el.textContent = num
    }

    check() {
        this.el.classList.add('pressed')
        this.counter.countClear()
        this.el.textContent = 'Clear!'
    }

  }

  class Board {
    constructor(counter) {
      this.counter = counter
      this.panel = new Panel(this.counter)
      this.setup()
    }

    setup() {
      const board = document.getElementById('board')
      board.appendChild(this.panel.getEl())
    }

    activate() {
      this.panel.activate(this.counter.getCount())
    }

    onSuccess = (value) => {
        this.count = value
        // 現在のカウントを更新
        this.counter.countUpdate(value)
        // 画面に表示
        this.activate()
    }

  }

  class Counter {
    constructor() {
      this.board = new Board(this)

      // カウントボタン
      const countUpBtn = document.getElementById('countUpBtn')
      google.script.run.withSuccessHandler(this.board.onSuccess).displayValue()

      countUpBtn.addEventListener('click', () => {
        // カウンターを一つ上げる
        this.countUp()
        // ボードに値表示
        this.board.activate()
      })
      this.setup()

      // 保存ボタン
      const saveBtn = document.getElementById('saveBtn')
      saveBtn.addEventListener('click', () => {
        // スプレッドシートに現在のカウント数保存
        google.script.run.saveValue(this.count)
      })

      // 表示ボタン
      const displayBtn = document.getElementById('displayBtn')
      displayBtn.addEventListener('click', () => {
        // スプレッドシートに保存していた値を取得して表示
        google.script.run.withSuccessHandler(this.board.onSuccess).displayValue()
      })

    }

    setup() {
      const container = document.getElementById('container')
    }

    countUp() {
      this.count++
    }

    getCount() {
      return this.count
    }
 
    countClear() {
      this.count = 0
    }

    countUpdate( num ) {
      this.count = num
    }

  }

  new Counter()
}
</script>
