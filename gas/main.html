<script>
'use strict'
{
  class Panel {
    constructor(counter) {
      this.counter = counter
      this.el = document.createElement('li')
      this.el.classList.add('pressed')
      this.el.textContent = 'Reset'
    }

    getEl() {
      return this.el
    }

    activate(num) {
      this.el.classList.remove('pressed')
      this.el.textContent = num
    }

    check() {
        this.el.classList.add('pressed')
        this.counter.countClear()
        this.el.textContent = 'Clear!'
    }

  }

  class Board {
    constructor(counter) {
      this.counter = counter
      this.panel = new Panel(this.counter)
      this.setup()
    }

    setup() {
      const board = document.getElementById('board')
      board.appendChild(this.panel.getEl())
    }

    activate() {
      this.panel.activate(this.counter.getCount())
    }

    onSuccess = (value) => {
        this.count = value
        // 現在のカウントを更新
        this.counter.countUpdate(value)
        // 画面に表示
        this.activate()
    }

  }

  class Counter {
    
    constructor() {
      new Vue({
        el: "#container",
        vuetify: new Vuetify(),
        data: {},
        methods: {
          // カウントボタン
          countUpBtnClicked(){
            // カウンターを一つ上げる
            thisCounter.countUp()
            // ボードに値表示
            thisCounter.board.activate()
          },
          // 保存ボタン
          saveBtnClicked(){
            // スプレッドシートに現在のカウント数保存
            google.script.run.saveValue(thisCounter.count)
          },
          // 表示ボタン
          displayBtnClicked(){
            // スプレッドシートに保存していた値を取得して表示
            google.script.run.withSuccessHandler(thisCounter.board.onSuccess).displayValue()
          },
          // リセットボタン
          resetBtnClicked(){
            // カウントの表示をリセット　
            thisCounter.board.panel.check()
          }
        },
        mounted() {}
      })

      this.board = new Board(this)
      const thisCounter = this

      // カウントボタン
      const countUpBtn = document.getElementById('countUpBtn')
      google.script.run.withSuccessHandler(this.board.onSuccess).displayValue()

      this.setup()

    }

    setup() {
      const container = document.getElementById('container')
    }

    countUp() {
      this.count++
    }

    getCount() {
      return this.count
    }
 
    countClear() {
      this.count = 0
    }

    countUpdate( num ) {
      this.count = num
    }

  }

  new Counter()
}
</script>
