<script>
'use strict'
{
  class Counter {
    constructor() {
      const thisCounter = this
      const app = new Vue({
        el: "#container",
        vuetify: new Vuetify(),
        data: {
          currentValue: 'RESET!',
          overlay: false
        },
        methods: {
          // カウントボタン
          countUpBtnClicked(){
            // カウンターを一つ上げる
            thisCounter.countUp()
            // ボードに値表示
             this.currentValue = thisCounter.getCount()
          },
          // 保存ボタン
          async saveBtnClicked(){
            app.setOverlay()
            const ServerScript = new Promise(( resolve ) => {
              // counterテーブルに現在のカウント数保存
              google.script.run.withSuccessHandler( resolve ).updateCounter(thisCounter.count)
            })
            await ServerScript
            app.setOverlay()
          },
          // 表示ボタン
          async displayBtnClicked(){
            app.setOverlay()
            const ServerScript = new Promise(( resolve ) => {
              // スプレッドシートに保存していた値を取得
              google.script.run.withSuccessHandler( resolve ).getCounter()
            })
            const value = await ServerScript
            this.cntDysplay(value)
          },
          // リセットボタン
          resetBtnClicked(){
            // カウントの表示をリセット　
            thisCounter.countClear()
            // ボードに「Clear!」と表示
             this.currentValue = 'Clear!'
          },
          // 画面表示
          cntDysplay(value){
            thisCounter.count = value
            // 現在のカウントを更新
            thisCounter.countUpdate(value)
            // 画面に表示
            this.currentValue = value
            app.setOverlay()
          },
          // オーバーレイの表示・非表示
          setOverlay(){
            this.overlay = !this.overlay
          }
        },
        mounted() {}
      })

      // 初期表示
      app.displayBtnClicked()

    }

    countUp() {
      this.count++
    }

    getCount() {
      return this.count
    }
 
    countClear() {
      this.count = 0
    }

    countUpdate( num ) {
      this.count = num
    }

  }

  new Counter()
}
</script>
